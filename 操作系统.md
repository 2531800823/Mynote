# 操作系统

### 进程和线程的区别

> 1. 进程是CPU资源分配的最小单位，线程是CPU调度的最小单位
> 2. 进程有独立的系统资源，同一进程的线程共享大部分资源(堆、代码段、数据段)，每一个线程值拥有一些在巡行中必不可少的私有属性比如：tcb、线程id、栈、寄存器
> 3. 一个进程崩溃，不会影响到其他进程，线程崩溃会让同一进城内的其他线程杀死
> 4. 进程在创建、切换和销毁时开销比较大，线程小，
>    1. 进程创建的时候需要分配系统资源分配，销毁的时候需要释放系统资源
>    2. 进程切换分为两步：切换页目录、刷新TLB使用心得地址空间；切换内核栈和硬件上下文（寄存器）
>    3. 线程：逻辑地址是是一样的，不需要切换页目录，刷新TLB

### 进程和线程的使用场景

> **多线程模型:**
>
> 1. 主要优势为线程切换代价小，因此适用于I/O密集的工作场景，因此I/O密集型的工作场景经常会由于I/O阻塞导致频繁切换线程，
> 2. 多线程也适用于单机多核模型
>
> 多进程模型：
>
> 1. 多进程模型的优势是CPU，适用于CPU密集型，同时，多进程模型也适用于多集分布式场景中，易于多集扩展

### 有了进程为什么还有线程

> 1. 进程在执行的过程中阻塞，整个进程就会挂起。进程只能在一个时间做一件事
> 2. 线程能够让不依赖输入的工作继续执行
> 3. 线程可以增加并发的程度，多进程也可以并发但是切换开销太大

### 死锁的产生和解决

> **产生死锁的条件**
>
> 1. ​	互斥性：一个资源每次只能被一个线程调用
> 2. 请求和保持条件：一个线程对请求被占有资源发生阻塞，对已经获取的资源不释放
> 3. 不剥夺：一个线程在释放资源之前，其他的线程无法剥夺占用
> 4. 循环等待：发生死锁时，线程进入死循环，永久阻塞
>
> **原因**
>
> 1. 竞争不可抢占性资源 
>    1. A在上海等B，B在北京等A，他俩都是等不到不走
> 2. 竞争可消耗资源引起的死锁
>    1. 程间通信，如果顺序不当，会产生死锁，比如p1发aa给p2, p1接收p3的消息cc,p2接收p1的aa,发bb给p3, 以此类推，如果进程之间是先发信息的那么可以完成通讯，但是如果是先接受信息就会产生死锁
> 3. 进程推进顺序不当
>    1. 进程在运行过程中，请求和释放资源的顺序不当，也会导致进程死锁
>
> **避免死锁的方法**
>
> 1. 破坏 请求和保持 条件
> 2. 破坏 不可抢占 条件 
>    1. 如果去抢资源，没抢到就 释放自己的资源，操作系统允许抢，只要优先级够大
> 3. 破坏 循环等待 条件
>    1. 申请必须按照资源的编号顺序提出

### 进程间的通讯方式

> 1. 管道
>    1. 匿名管道：pipe 半双工，只可以在有血缘关系的进程通信，数据是单向流动的
>    2. 有名管道：fife 允许没有血缘关系的进程通信
> 2. 信号 signal
>    1. 用于通知接收进程中有某种事件发生，除了用于进程间通信外，进程还可以发送信号给进程本身
> 3. 消息队列
>    1. 是消息的链接表，存放在内存中，一个消息队列由一个消息队列标识符标记，克服了信号传递少，管道只能承载无格式字节流和缓冲区受限制的特点
>    2. 独立于进程，进程退出 消息队列的内容不会被删除
>    3. 可以随机查看 也可以按照消息的类型读取
> 4. 信号量
>    1. 是一个计数器，可以用来控制多个进程对共享资源的访问，它通常作为一种锁机制，防止某进程在访问共享资源时，别的进程也在访问
> 5. 共享内存
>    1. 映射一段能被其他进程所访问的共享内存，这段内存由一个进程创建，是最快的IPC形式，要搭配信号量来同步互斥共享资源
> 6. 本地套接字
>    1. 也是一种进程间通信方式，和其他进程通信不同，也可以和不同主机的进程通信

### 线程的同步方式

> 信号量：sem
>
> 互斥量：pthread_mutex_t
>
> 条件变量：pthread_cond_t

### 怎么样保证线程安全

> 

### 为什么要使用线程池

> 创建线程和销毁线程开销大，再加上处理业务，导致系统资源不足，

### 进程调度算法

> 1. 先来先服务
> 2. 时间片轮换法
> 3. 多级反馈队列算法
> 4. 最短进程优先
>
> #### 抢占式 ········································
>
> ​	允许逻辑上可继续运行，在运行过程暂停调度，可以防止单一进程长时间占用CPU，系统开销大（降低途径：硬件实现进程切换，或扩充主存以贮存大部分程序
>
> #### 非抢占式·····································
>
> ​	让进程运行知道结束或阻塞的调度方式，容易实现，适用于专用系统，不适用通用的系统

### 虚拟内存机制

> ​	防止不同进程同一时刻在物理对物理内存的争夺和践踏，采用了虚拟内存技术

### 常用命令

> 1. ps
>    1. ps -ef -aux -auj 查看正在运行的程序
> 2. grep 
>    1. 管道 用来筛选的
> 3. top
>    1. 相当于windows查看任务管理的
> 4. kill 
>    1. 想程序发信号的，-9 是杀死程序

### C++的锁有几种

> 互斥锁 条件变量 读写锁 自旋锁

​	